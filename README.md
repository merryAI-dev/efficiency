# 정산 문서 자동 처리 시스템

AI 기반 정산 문서 자동 분류 및 합본 생성 시스템

## 🎯 주요 기능

- **AI 기반 문서 분류**: GPT-4o-mini로 파일명 자동 분류
- **폴더 정보 추출**: 번호, 업체명, 비용유형 자동 추출
- **PDF 자동 합본**: 문서 순서에 맞게 PDF 병합
- **필수 문서 체크**: 비용유형별 필수 서류 자동 확인
- **구글 시트 연동**: 처리 결과 자동 업로드
- **이미지 지원**: JPG, PNG 등 자동 PDF 변환

## 📋 처리 프로세스

```
폴더 스캔 → GPT 분류 → 문서 정렬 → PDF 합본 → 결과 생성
```

### 1. 폴더명에서 정보 추출
```
입력: "149, 152. 이정근_직접비_일반수용비"
출력: 번호=[149, 152], 이름=이정근, 비용유형=일반수용비
```

### 2. 파일명 자동 분류
```
입력: "149. 이체확인증.pdf"
출력: 문서타입=이체확인증
```

### 3. 순서대로 합본 생성
```
출력: "149-152_이정근_일반수용비_합본.pdf"
```

## 🚀 사용 방법

### Google Colab에서 실행

1. **노트북 열기**
   - `정산문서처리.ipynb` 파일을 Google Colab에서 열기

2. **API 키 설정**
   ```python
   # Cell 6
   OPENAI_API_KEY = "sk-proj-..." # OpenAI API 키 입력
   ```

3. **셀 순서대로 실행**
   - Cell 2: Google Drive 마운트
   - Cell 3: 라이브러리 설치
   - Cell 4-12: 클래스 정의
   - Cell 13: 메인 실행 ▶️
   - Cell 14: 구글 시트 업로드

## 📊 출력 예시

```
[1/3] 폴더 스캔 중...
      -> 47개 폴더 발견

스캔 결과 미리보기:
  [176-178] 강혜원 (일반수용비)
  [179] 구테로이테 (기타)
  [146] 신세계프라퍼티 (행사비)
  ...

[2/3] PDF 합본 생성 중... (총 47개)
[1/47] 176-178. 강혜원 (일반수용비) ✅ 176-178_강혜원_일반수용비_합본.pdf
[2/47] 179. 구테로이테 (기타) ✅ 179_구테로이테_기타_합본.pdf
...

✅ 완료! 총 47개 폴더 처리, 45개 합본 생성
```

## 🗂️ 지원 문서 타입

### 일반수용비
- 원천징수영수증, 이체확인증, 이력서, 통장사본
- 신분증, 비용지급확인서, 자문보고서, 강의자료

### 용역비 (일반용역비)
- 전자세금계산서, 견적서, 계약서, 이체확인증
- 사업자등록증, 통장사본, 자문보고서

### 행사비
- 매출전표

### 사업추진비
- 매출전표, 영수증, 회의록

## ⚙️ 설정 (Cell 6)

```python
class Config:
    # 경로 설정
    BASE_PATH = "/content/drive/Shareddrives/..."

    # API 설정
    OPENAI_API_KEY = "your-api-key-here"
    USE_GPT_CLASSIFICATION = True  # GPT 사용

    # 구글 시트
    SHEET_URL = "https://docs.google.com/spreadsheets/d/..."

    # 필수 문서 정의
    REQUIRED_DOCS = {
        "일반수용비": ["원천징수영수증", "이체확인증", ...],
        "용역비": ["전자세금계산서", "견적서", ...],
        ...
    }
```

## 💰 비용

- **GPT-4o-mini** 사용
- 폴더 50개 × 파일 평균 10개 = 약 500 API 호출
- **예상 비용: $0.025 (약 30원)**

## 📁 파일 구조

```
주디네/
├── 정산문서처리.ipynb          # 메인 노트북
├── README.md                    # 이 문서
├── gpt_extractor.py            # GPT 추출기 (참고용)
├── process_with_logs.py        # 로컬 처리 스크립트
└── extraction_debug.log        # 디버깅 로그
```

## 🔧 문제 해결

### 파일이 "기타"로 분류되는 경우
- GPT API 키가 올바른지 확인
- `USE_GPT_CLASSIFICATION = True`로 설정되었는지 확인

### 합본이 생성되지 않는 경우
- PDF 파일이 손상되지 않았는지 확인
- 폴더 내 최소 1개 이상의 PDF/이미지 파일 필요

### API 비용이 걱정되는 경우
```python
USE_GPT_CLASSIFICATION = False  # 정규식 모드로 전환
```

## 📝 출력 데이터

구글 시트에 자동 업로드되는 컬럼:
- 폴더번호
- 이름
- 비용유형
- 업로드파일
- 필수문서체크
- 누락문서
- 합본파일명

## 🎓 참고

- GPT-4o-mini API: https://platform.openai.com/docs
- PyPDF2 문서: https://pypdf2.readthedocs.io/
- Google Colab: https://colab.research.google.com/

## 📜 라이센스

MIT License

## 👤 작성자

AI 기반 정산 자동화 시스템 v1.0

---

**최종 업데이트**: 2025-10-29
